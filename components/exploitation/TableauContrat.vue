<template>
  <div class="container-fluid">
    <b-overlay :show="$fetchState.pending" spinner-variant="primary" rounded="sm">
      <div class="row">
        <div class="col-sm-6 col-lg-4">
          <GridCounter :options="optionsDemande" />
        </div>
        <div class="col-sm-6 col-lg-4">
          <GridCounter :options="optionsPersonne" />
        </div>
        <div class="col-sm-6 col-lg-4">
          <GridCounter :options="optionsEquipement" />
        </div>
        <div class="col-sm-6 col-lg-4">
          <GridCounter :options="optionsEmplacement" />
        </div>
        <div class="col-sm-6 col-lg-4">
          <GridCounter :options="optionsAbonnement" />
        </div>
        <div class="col-sm-6 col-lg-4">
          <GridCounter :options="optionsGearsEmplacement" />
        </div>
      </div>
    </b-overlay>
  </div>
</template>

<script>
import { mapActions, mapGetters } from 'vuex'
import GridCounter from '~/components/dashboard/GridCounter.vue'
import { MODULES } from '~/helper/modules-types'
export default {
  components: { GridCounter },
  fetch() {
    this.getDemandeRate()
    this.getPersonneRate()
    this.getBusyRate()
    this.getEquippedRate()
    this.getLinkedRate()
    this.getSubscribedRate()
  },
  computed: {
    ...mapGetters({
      validation: MODULES.DASHBOARD.RECEPTION.GETTERS.VALIDATION,
      conversion: MODULES.DASHBOARD.RECEPTION.GETTERS.CONVERSION,
      busy: MODULES.DASHBOARD.RECEPTION.GETTERS.BUSY,
      equipped: MODULES.DASHBOARD.RECEPTION.GETTERS.EQUIPPED,
      linked: MODULES.DASHBOARD.RECEPTION.GETTERS.LINKED,
      subscribed: MODULES.DASHBOARD.RECEPTION.GETTERS.SUBSCRIBED,
    }),
    optionsDemande() {
      return {
        key: 'validation',
        title: 'Taux de concrétisation des demandes',
        firstPercentName: 'Demandes en cours',
        secondPercentName: 'Demandes Validées',
        firstCount: Number(this.validation.demandesEnCours),
        secondCount: Number(this.validation.demandesValidees),
      }
    },
    optionsPersonne() {
      return {
        key: 'conversion',
        title: 'Taux de convertion des prospects',
        firstPercentName: 'Prospects',
        secondPercentName: 'Clients',
        firstCount: Number(this.conversion.prospects),
        secondCount: Number(this.conversion.clients),
      }
    },
    optionsEmplacement() {
      return {
        key: 'busy',
        title: "Taux d'occupation des emplacements",
        firstPercentName: 'Emplacements Disponibles',
        secondPercentName: 'Emplacements Occupés',
        firstCount: Number(this.busy.emplacementsDisponibles),
        secondCount: Number(this.busy.emplacementsOccupes),
      }
    },
    optionsGearsEmplacement() {
      return {
        key: 'equipped',
        title: "Taux d'équipement des emplacements",
        firstPercentName: 'Avec Equipement',
        secondPercentName: 'Sans Equipement',
        firstCount: Number(this.equipped.emplacementsEquipes),
        secondCount: Number(this.equipped.emplacementsSansEquipement),
      }
    },
    optionsAbonnement() {
      return {
        key: 'subscribed',
        title: "Taux d'abonnement par emplacement",
        firstPercentName: 'Avec Abonnements',
        secondPercentName: 'Sans Abonnements',
        firstCount: Number(this.subscribed.emplacementsAbonnes),
        secondCount: Number(this.subscribed.emplacementsNonAbonnes),
      }
    },
    optionsEquipement() {
      return {
        key: 'linked',
        title: 'Taux des équipements en utilisation',
        firstPercentName: 'Equipements Liés',
        secondPercentName: 'Equipements Libres',
        firstCount: Number(this.linked.equipementsLies),
        secondCount: Number(this.linked.equipementsLibres),
      }
    },
  },
  methods: {
    ...mapActions({
      getDemandeRate: MODULES.DASHBOARD.RECEPTION.ACTIONS.VALIDATION_RATE,
      getPersonneRate: MODULES.DASHBOARD.RECEPTION.ACTIONS.CONVERSION_RATE,
      getBusyRate: MODULES.DASHBOARD.RECEPTION.ACTIONS.BUSY_RATE,
      getEquippedRate: MODULES.DASHBOARD.RECEPTION.ACTIONS.EQUIPPED_RATE,
      getLinkedRate: MODULES.DASHBOARD.RECEPTION.ACTIONS.LINKED_RATE,
      getSubscribedRate: MODULES.DASHBOARD.RECEPTION.ACTIONS.SUBSCRIBED_RATE,
    }),
  },
}
</script>

<style scoped></style>
