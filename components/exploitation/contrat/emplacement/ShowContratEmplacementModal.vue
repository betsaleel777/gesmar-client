<template>
  <b-modal
    id="modalShowContratEmplacement"
    v-model="dialog"
    scrollable
    size="lg"
  >
    <template #modal-header>
      <h5 class="modal-title text-primary">
        Détails du contrat {{ contrat.code }}
      </h5>
      <button
        type="button"
        class="close"
        aria-label="Close"
        @click="dialog = false"
      >
        <span aria-hidden="true"><feather type="x" /></span>
      </button>
    </template>
    <template #default>
      <div class="card card-invoice">
        <div class="card-header">
          <div>
            <h5 class="mg-b-3">Contrat {{ contrat.code }}</h5>
            <span class="tx-sm text-muted"
              >fait le: {{ $moment(contrat.created_at).format('ll') }}</span
            >
          </div>
          <div class="btn-group-invoice">
            <a type="button" class="btn btn-white btn-sm btn-uppercase"
              ><feather type="printer" /> Imprimer</a
            >
            <a href="" class="btn btn-white btn-sm btn-uppercase"
              ><feather type="mail" /> Email</a
            >
            <a
              v-if="validable"
              type="button"
              class="btn btn-brand-02 btn-sm btn-uppercase"
              @click="valider"
              ><feather type="credit-card" /> Valider</a
            >
          </div>
        </div>
        <!-- card-header -->
        <div class="card-body">
          <div class="row">
            <div class="col-sm-6">
              <!-- <label class="content-label">Billed From</label> -->
              <h6 class="tx-15 mg-b-10">{{ contrat.site.nom }}</h6>
              <p class="mg-b-0">{{ contrat.site.adresse }}</p>
              <p class="mg-b-0">Tel No: {{ contrat.site.contact }}</p>
              <p class="mg-b-0">Email: {{ contrat.site.email }}</p>
            </div>
            <!-- col -->
            <div class="col-sm-6 tx-right d-none d-md-block">
              <label class="content-label">Code du contrat</label>
              <h2 class="tx-normal tx-gray-400 mg-b-10 tx-spacing--2">
                {{ contrat.code }}
              </h2>
            </div>
            <!-- col -->
            <div class="col-sm-6 col-lg-8 mg-t-40 mg-sm-t-0 mg-md-t-40">
              <label class="content-label">facturé à</label>
              <h6 class="tx-15 mg-b-10">{{ contrat.personne.nomComplet }}</h6>
              <p class="mg-b-0">{{ contrat.personne.ville }}</p>
              <p class="mg-b-0">{{ contrat.personne.contact }}</p>
              <p v-if="contrat.personne.email" class="mg-b-0">
                {{ contrat.personne.email }}
              </p>
            </div>
            <!-- col -->
            <div class="col-sm-6 col-lg-4 mg-t-40">
              <label class="content-label">Information du contrat</label>
              <ul class="list-unstyled lh-7">
                <li class="d-flex justify-content-between">
                  <span>Code du contrat:</span>
                  <span>{{ contrat.code }}</span>
                </li>
                <li class="d-flex justify-content-between">
                  <span>Début: </span>
                  <span
                    >du {{ $moment(contrat.debut).format('DD-MM-YYYY') }}
                  </span>
                </li>
                <li class="d-flex justify-content-between">
                  <span>Fin: </span>
                  <span>{{
                    $moment(contrat.debut).add(1, 'Y').format('DD-MM-YYYY')
                  }}</span>
                </li>
                <li class="d-flex justify-content-between">
                  <span>Due Date</span>
                  <span>April 21, 2019</span>
                </li>
              </ul>
            </div>
            <!-- col -->
          </div>
          <!-- row -->
          <h5 class="mg-t-25">Emplacement</h5>
          <div class="table-responsive">
            <table class="table table-invoice bd-b">
              <thead>
                <tr>
                  <th class="wd-20p">Code emplacement</th>
                  <th class="tx-center">Type</th>
                  <th class="tx-center">Superficie</th>
                  <th class="tx-right">Loyer</th>
                  <th class="tx-right">Pas de porte</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="tx-nowrap">{{ contrat.emplacement.code }}</td>
                  <td class="tx-center">
                    {{ contrat.emplacement.type.nom }}
                  </td>
                  <td class="tx-center">
                    {{ contrat.emplacement.superficie }}
                  </td>
                  <td class="tx-right">{{ contrat.emplacement.loyer }}</td>
                  <td class="tx-right">{{ contrat.emplacement.pas_porte }}</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div v-if="contrat.emplacement.equipements.length > 0">
            <h5 class="mg-t-25">Equipements</h5>
            <div class="table-responsive">
              <table class="table table-invoice bd-b">
                <thead>
                  <tr>
                    <th class="wd-20p">Code equipement</th>
                    <th class="tx-center">Type</th>
                    <th class="tx-center">Prix unitaire</th>
                    <th class="tx-right">Prix fixe</th>
                    <th class="tx-right">Index</th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    v-for="(equipement, index) in contrat.emplacement
                      .equipements"
                    :key="index"
                  >
                    <td class="tx-nowrap">{{ equipement.code }}</td>
                    <td class="tx-center">
                      {{ equipement.type.nom }}
                    </td>
                    <td class="tx-center">
                      {{ equipement.prix_unitaire }}
                    </td>
                    <td class="tx-right">{{ equipement.prix_fixe }}</td>
                    <td class="tx-right">
                      {{ equipement.index }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="row justify-content-between mg-t-25">
            <div class="col-sm-6 col-lg-6 order-2 order-sm-0 mg-t-40 mg-sm-t-0">
              <label class="content-label mg-b-10">Notez bien</label>
              <p class="tx-sm">
                Sed ut perspiciatis unde omnis iste natus error sit voluptatem
                accusantium doloremque laudantium, totam rem aperiam, eaque ipsa
                quae ab illo inventore veritatis et quasi architecto beatae
                vitae dicta sunt explicabo.
              </p>
            </div>
            <!-- col -->
            <div class="col-sm-6 col-lg-4 order-1 order-sm-0">
              <!-- <ul class="list-unstyled lh-7 pd-r-10">
                <li class="d-flex justify-content-between">
                  <span>Sub-Total</span>
                  <span>$5,750.00</span>
                </li>
                <li class="d-flex justify-content-between">
                  <span>Tax (5%)</span>
                  <span>$287.50</span>
                </li>
                <li class="d-flex justify-content-between">
                  <span>Discount</span>
                  <span>-$50.00</span>
                </li>
                <li class="d-flex justify-content-between">
                  <strong>Total Due</strong>
                  <strong>$5,987.50</strong>
                </li>
              </ul> -->
              <button
                v-if="validable"
                class="btn btn-block btn-primary btn-brand-02"
              >
                valider
              </button>
            </div>
            <!-- col -->
          </div>
        </div>
        <!-- card-body -->
      </div>
    </template>
  </b-modal>
</template>

<script>
import { mapActions } from 'vuex'
import { CONTRAT } from '~/helper/constantes'
export default {
  props: {
    contrat: {
      type: Object,
      required: true,
    },
    value: Boolean,
  },
  data: () => ({
    PROFORMA: CONTRAT.status.proforma,
  }),
  computed: {
    dialog: {
      get() {
        return this.value
      },
      set(value) {
        this.$emit('input', value)
      },
    },
    validable() {
      return (
        !this.contrat.emplacement.auto_valid &&
        this.contrat.status === this.PROFORMA
      )
    },
  },
  methods: {
    ...mapActions({ getValider: 'exploitation/contrat-emplacement/valider' }),
    valider() {
      this.getValider(this.contrat.id).then((message) => {
        this.$bvToast.toast(message, {
          title: 'succès de la création'.toLocaleUpperCase(),
          variant: 'success',
          solid: true,
        })
        this.dialog = false
      })
    },
  },
}
</script>

<style></style>
