<template>
  <div class="container-fluid">
    <div class="d-flex d-print-none">
      <PartialBreadcrumb :liens="liens" />
    </div>
    <b-overlay :show="$fetchState.pending" spinner-variant="primary" rounded="sm">
      <ApercuContratBail v-if="content" :content="content" @printed="imprimer" />
    </b-overlay>
  </div>
</template>

<script>
import { mapActions } from 'vuex'
import ApercuContratBail from '~/components/exploitation/contrat/ApercuContratBail.vue'
import PartialBreadcrumb from '~/components/partials/PartialBreadcrumb.vue'
import { MODULES } from '~/helper/modules-types'

export default {
  components: { PartialBreadcrumb, ApercuContratBail },
  data: () => ({
    contrat: { code: null },
    content: null,
  }),
  async fetch() {
    const { contrat } = await this.getOne(this.$route.params.id)
    this.contrat = contrat
    const { message, content } = await this.getContent(this.$route.params.id)
    if (message) this.$notify({ text: message, title: "succès de l'opération", type: 'error' })
    if (content) this.content = content
  },
  head() {
    return {
      title: `Aperçu du contrat de bail ${this.contrat.code}`,
      meta: [
        {
          hid: `contrat ${this.contrat.code}`,
          name: `contrat ${this.contrat.code}`,
          content: `Aperçu du contrat de bail ${this.contrat.code}`,
        },
      ],
    }
  },
  computed: {
    liens() {
      return [
        { path: '/exploitation/reception', text: 'Acceuil Reception' },
        { path: '/exploitation/reception/parent/demande', text: 'Demande à traiter' },
        { path: '#', text: this.contrat.code },
      ]
    },
  },
  methods: {
    ...mapActions({ getOne: MODULES.CONTRAT.BAIL.ACTIONS.ONE, getContent: MODULES.CONTRAT.BAIL.ACTIONS.CONTENT }),
    imprimer() {
      window.document.title = `${this.contrat.code}-${this.$moment().unix()}`
      window.print()
    },
  },
}
</script>
<style scoped>
@media print {
  .container-fluid {
    padding-inline: 0px;
  }
}
</style>
