<template>
  <div class="container-fluid">
    <PartialBreadcrumb :liens="liens" />
    <div class="col-md-12 col-sm-12">
      <b-tabs v-model="tabIndex" lazy content-class="mt-7" active-nav-item-class="font-weight-bold">
        <b-tab title="Tableau" :title-link-class="linkClass(0)">
          <TableauContrat />
        </b-tab>
        <b-tab :disabled="disableContrat" title="Demandes" :title-link-class="linkClass(1)">
          <ListeContrat />
        </b-tab>
        <b-tab :disabled="disablePersonne" title="Prospects" :title-link-class="linkClass(2)">
          <ListeProspect v-if="!archive.prospect" @archivage="archive.prospect = true" />
          <ListeProspectArchive v-else @back="onBack(2)" />
        </b-tab>
        <b-tab :disabled="disablePersonne" title="Clients" :title-link-class="linkClass(3)">
          <ListeClient v-if="!archive.client" @archivage="archive.client = true" />
          <ListeClientArchive v-else @back="onBack(3)" />
        </b-tab>
        <b-tab :disabled="disableContratValide" title="Contrats Valides" :title-link-class="linkClass(4)">
          <ListeContratValide />
        </b-tab>
      </b-tabs>
    </div>
  </div>
</template>
<script>
import PartialBreadcrumb from '~/components/partials/PartialBreadcrumb.vue'
import ListeContrat from '~/components/exploitation/contrat/ListeContrat.vue'
import ListeClient from '~/components/exploitation/client/ListeClient.vue'
import TableauContrat from '~/components/exploitation/TableauContrat.vue'
import ListeProspect from '~/components/exploitation/prospect/ListeProspect.vue'
import ListeProspectArchive from '~/components/exploitation/prospect/ListeProspectArchive.vue'
import ListeClientArchive from '~/components/exploitation/client/ListeClientArchive.vue'
import ListeContratValide from '~/components/exploitation/contrat/ListeContratValide.vue'
import { contrat, personne } from '~/helper/permissions'

export default {
  components: {
    PartialBreadcrumb,
    ListeContrat,
    ListeClient,
    TableauContrat,
    ListeProspect,
    ListeProspectArchive,
    ListeClientArchive,
    ListeContratValide,
  },
  data: () => ({
    liens: [{ path: '#', text: 'Reception' }],
    archive: {
      contrat: false,
      prospect: false,
      client: false,
    },
    tabIndex: 0,
  }),
  computed: {
    disableContrat() {
      return !this.$gates.hasAnyPermission(`${contrat.global}|${contrat.own}`)
    },
    disableContratValide() {
      return !this.$gates.hasAnyPermission(`${contrat.listValidGlobal}|${contrat.listValidOwn}`)
    },
    disablePersonne() {
      return !this.$gates.hasAnyPermission(`${personne.global}|${personne.own}`)
    },
  },
  methods: {
    onBack(numero) {
      if (numero === 2) {
        this.archive.prospect = false
        this.getProspects()
      } else if (numero === 3) {
        this.archive.client = false
        this.getClients()
      }
    },
    linkClass(idx) {
      if (this.tabIndex === idx) {
        return ['bg-white', 'text-primary']
      } else {
        return ['bg-light', 'text-primary']
      }
    },
  },
}
</script>
<style></style>
