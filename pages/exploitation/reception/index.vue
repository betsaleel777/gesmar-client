<template>
  <div>
    <PartialBreadcrumb :liens="liens" />
    <div class="content-body content-body-components">
      <b-tabs
        v-model="tabIndex"
        content-class="mt-7"
        active-nav-item-class="font-weight-bold"
      >
        <b-overlay :show="$fetchState.pending" rounded="sm">
          <b-tab title="Tableau" :title-link-class="linkClass(0)">
            <TableauContrat />
          </b-tab>
          <b-tab title="Contrats" :title-link-class="linkClass(1)">
            <ListeContrat
              v-if="!archive.contrat"
              :contrats="contrats"
              :types="typeContrats"
              @archivage="archive.contrat = true"
            />
            <ListeContratArchive v-else @back="onBack(1)" />
          </b-tab>
          <b-tab title="Prospects" :title-link-class="linkClass(2)">
            <ListeProspect
              v-if="!archive.prospect"
              :prospects="prospects"
              :marches="marches"
              :types="typePersonnes"
              @archivage="archive.prospect = true"
            />
            <ListeProspectArchive v-else @back="onBack(2)" />
          </b-tab>
          <b-tab title="Clients" :title-link-class="linkClass(3)">
            <ListeClient
              v-if="!archive.client"
              :clients="clients"
              :marches="marches"
              :types="typePersonnes"
              @archivage="archive.client = true"
            />
            <ListeClientArchive v-else @back="onBack(3)" />
          </b-tab>
        </b-overlay>
      </b-tabs>
    </div>
    <!-- content-right -->
  </div>
</template>
<script>
import { mapGetters, mapActions } from 'vuex'
import PartialBreadcrumb from '~/components/partials/PartialBreadcrumb.vue'
import ListeContrat from '~/components/exploitation/contrat/ListeContrat.vue'
import ListeContratArchive from '~/components/exploitation/contrat/ListeContratArchive.vue'
import ListeClient from '~/components/exploitation/client/ListeClient.vue'
import TableauContrat from '~/components/exploitation/TableauContrat.vue'
import ListeProspect from '~/components/exploitation/prospect/ListeProspect.vue'
import ListeProspectArchive from '~/components/exploitation/prospect/ListeProspectArchive.vue'
import ListeClientArchive from '~/components/exploitation/client/ListeClientArchive.vue'
export default {
  components: {
    PartialBreadcrumb,
    ListeContrat,
    ListeContratArchive,
    ListeClient,
    TableauContrat,
    ListeProspect,
    ListeProspectArchive,
    ListeClientArchive,
  },
  data: () => ({
    liens: [{ path: '#', text: 'Reception' }],
    archive: {
      contrat: false,
      prospect: false,
      client: false,
    },
    tabIndex: 0,
  }),
  fetch() {
    this.getContrats()
    this.getClients()
    this.getProspects()
    this.getSites()
    this.getTypeContrats()
    this.getTypePersonnes()
  },
  computed: {
    ...mapGetters({
      contrats: 'exploitation/contrat/contrats',
      prospects: 'exploitation/prospect/prospects',
      clients: 'exploitation/client/clients',
      typePersonnes: 'exploitation/typePersonne/types',
      typeContrats: 'exploitation/typeContrat/types',
      marches: 'architecture/marche/marches',
    }),
  },
  methods: {
    ...mapActions({
      getContrats: 'exploitation/contrat/getAll',
      getProspects: 'exploitation/prospect/getAll',
      getClients: 'exploitation/client/getAll',
      getTypeContrats: 'exploitation/typeContrat/getAll',
      getTypePersonnes: 'exploitation/typePersonne/getAll',
      getSites: 'architecture/marche/getAll',
    }),
    onBack(numero) {
      if (numero === 1) {
        this.archive.contrat = false
        this.getContrats()
      } else if (numero === 2) {
        this.archive.prospect = false
        this.getProspects()
      } else if (numero === 3) {
        this.archive.client = false
        this.getClients()
      }
    },
    linkClass(idx) {
      if (this.tabIndex === idx) {
        return ['bg-white', 'text-primary']
      } else {
        return ['bg-light', 'text-primary']
      }
    },
  },
}
</script>
<style></style>
