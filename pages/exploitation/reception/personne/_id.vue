<template>
  <div class="container-fluid">
    <PartialBreadcrumb :liens="liens" />
    <b-tabs v-model="tabIndex" lazy content-class="mt-7" active-nav-item-class="font-weight-bold">
      <b-tab title="Informations Générales" :title-link-class="linkClass(0)">
        <InformationsGenerale :personne="personne" />
      </b-tab>
      <b-tab v-if="personne.status === status.client" :disabled="disableContrat" title="Demandes" :title-link-class="linkClass(1)">
        <ListeDemandePersonne :id="$route.params.id" />
      </b-tab>
      <b-tab v-if="personne.status === status.client" :disabled="disableContratValide" title="Contrat en cours" :title-link-class="linkClass(2)">
        <ListeContratPersonne :id="$route.params.id" />
      </b-tab>
      <b-tab v-if="personne.status === status.client" :disabled="disableContrat" title="Contrats Résiliés" :title-link-class="linkClass(3)">
        <ListeContratAborted :id="$route.params.id" />
      </b-tab>
      <b-tab title="Factures" :title-link-class="linkClass(4)">
        <ListeFacturePersonne :id="$route.params.id" />
      </b-tab>
    </b-tabs>
  </div>
</template>
<script>
import { mapActions } from 'vuex'
import InformationsGenerale from '~/components/exploitation/personne/InformationsGenerale.vue'
import ListeDemandePersonne from '~/components/exploitation/personne/ListeDemandePersonne.vue'
import ListeContratPersonne from '~/components/exploitation/personne/ListeContratPersonne.vue'
import ListeContratAborted from '~/components/exploitation/personne/ListeContratAborted.vue'
import ListeFacturePersonne from '~/components/exploitation/personne/ListeFacturePersonne.vue'
import { MODULES } from '~/helper/modules-types'
import { PERSONNE } from '~/helper/constantes'
import { contrat } from '~/helper/permissions'
import PartialBreadcrumb from '~/components/partials/PartialBreadcrumb.vue'
export default {
  components: { InformationsGenerale, ListeDemandePersonne, ListeContratPersonne, ListeContratAborted, ListeFacturePersonne, PartialBreadcrumb },
  data: () => ({
    tabIndex: 0,
    personne: {},
    status: PERSONNE,
  }),
  async fetch() {
    const { personne } = await this.getOne(this.$route.params.id)
    this.personne = personne
  },
  computed: {
    disableContrat() {
      return !this.$gates.hasAnyPermission(`${contrat.global}|${contrat.own}`)
    },
    disableContratValide() {
      return !this.$gates.hasAnyPermission(`${contrat.listValidGlobal}|${contrat.listValidOwn}`)
    },
    liens() {
      return [
        { path: '/exploitation/reception', text: 'Acceuil Reception' },
        {
          path: PERSONNE.prospect === this.personne.status ? '/exploitation/reception/parent/prospect' : '/exploitation/reception/parent/client',
          text: PERSONNE.prospect === this.personne.status ? 'Prospects' : 'Clients',
        },
        { path: '#', text: this.personne.fullname },
      ]
    },
  },
  methods: {
    ...mapActions({ getOne: MODULES.PERSONNE.ACTIONS.ONE }),
    linkClass(idx) {
      if (this.tabIndex === idx) {
        return ['bg-white', 'text-primary']
      } else {
        return ['bg-light', 'text-primary']
      }
    },
  },
}
</script>
<style scoped>
.v-application {
  background-color: rgb(0, 0, 0) !important;
}
</style>
